# F3.T5: Fitness Calculator & Persistence

## Agent: AI_SENIOR

## Task Overview
Implement fitness calculation from game results and population persistence to SQLite database.

## Context
Project: `src/TzarBot.GeneticAlgorithm/`. Use SQLite for persistence.

## Requirements

1. Add NuGet packages:
   - Microsoft.Data.Sqlite
   - Dapper (optional)

2. Create GameResult in Common:
   ```csharp
   public class GameResult
   {
       public Guid GenomeId { get; set; }
       public GameOutcome Outcome { get; set; }
       public TimeSpan Duration { get; set; }
       public int UnitsBuilt { get; set; }
       public int BuildingsBuilt { get; set; }
       public int EnemyUnitsKilled { get; set; }
       public int EnemyBuildingsDestroyed { get; set; }
       public int ResourcesGathered { get; set; }
       public int IdleTimeSeconds { get; set; }
       public int InvalidActionsCount { get; set; }
       public DateTime PlayedAt { get; set; }
   }

   public enum GameOutcome
   {
       Victory, Defeat, Timeout, Crashed, Stuck, Cancelled
   }
   ```

3. Create FitnessConfig with weights for:
   - Win/loss bonuses
   - Time bonuses
   - Activity weights
   - Penalties

4. Implement `FitnessCalculator`:
   - Calculate fitness from game result
   - Aggregate multiple games
   - Non-negative output

5. Implement `SqliteGenomeRepository`:
   - Create tables (Genomes, GameResults)
   - CRUD operations
   - Query by generation
   - Index for performance

6. Create tests:
   - Test_Fitness_Win_HigherThan_Loss
   - Test_Fitness_FastWin_HigherThan_SlowWin
   - Test_Fitness_NonNegative
   - Test_Repository_SaveAndLoad_RoundTrip
   - Test_Repository_GetGeneration

## Outputs
- `src/TzarBot.GeneticAlgorithm/Fitness/IFitnessCalculator.cs`
- `src/TzarBot.GeneticAlgorithm/Fitness/FitnessCalculator.cs`
- `src/TzarBot.GeneticAlgorithm/Fitness/FitnessConfig.cs`
- `src/TzarBot.GeneticAlgorithm/Persistence/IGenomeRepository.cs`
- `src/TzarBot.GeneticAlgorithm/Persistence/SqliteGenomeRepository.cs`
- `tests/TzarBot.Tests/Phase3/FitnessTests.cs`
- `tests/TzarBot.Tests/Phase3/PersistenceTests.cs`

## Test Command
```bash
dotnet test tests/TzarBot.Tests --filter "FullyQualifiedName~Phase3.Fitness|Phase3.Persistence"
```
