# F2.T1: NetworkGenome & Serialization

## Agent: AI_SENIOR

## Task Overview
Create the NetworkGenome class and serialization for neural network representation.

## Context
Create new project `src/TzarBot.NeuralNetwork/`. Use MessagePack for serialization.

## Requirements

1. Create project with dependencies:
   - MessagePack
   - System.Numerics.Tensors

2. Create `ActivationType` enum:
   ```csharp
   public enum ActivationType
   {
       ReLU,
       LeakyReLU,
       Tanh,
       Sigmoid,
       Linear
   }
   ```

3. Create `LayerConfig` classes:
   ```csharp
   [MessagePackObject]
   public abstract class LayerConfig
   {
       [Key(0)] public abstract LayerType Type { get; }
   }

   [MessagePackObject]
   public class ConvLayerConfig : LayerConfig
   {
       [Key(1)] public int Filters { get; set; }
       [Key(2)] public int KernelSize { get; set; }
       [Key(3)] public int Stride { get; set; }
       [Key(4)] public ActivationType Activation { get; set; }
   }

   [MessagePackObject]
   public class DenseLayerConfig : LayerConfig
   {
       [Key(1)] public int NeuronCount { get; set; }
       [Key(2)] public ActivationType Activation { get; set; }
       [Key(3)] public float DropoutRate { get; set; }
   }
   ```

4. Create `NetworkGenome`:
   ```csharp
   [MessagePackObject]
   public class NetworkGenome
   {
       [Key(0)] public Guid Id { get; set; }
       [Key(1)] public int Generation { get; set; }
       [Key(2)] public float Fitness { get; set; }
       [Key(3)] public float? EloRating { get; set; }
       [Key(4)] public List<ConvLayerConfig> ConvLayers { get; set; }
       [Key(5)] public List<DenseLayerConfig> HiddenLayers { get; set; }
       [Key(6)] public float[] Weights { get; set; }
       [Key(7)] public Guid? ParentId1 { get; set; }
       [Key(8)] public Guid? ParentId2 { get; set; }
       [Key(9)] public DateTime CreatedAt { get; set; }
       [Key(10)] public int InputWidth { get; set; }
       [Key(11)] public int InputHeight { get; set; }
       [Key(12)] public int InputChannels { get; set; }
       [Key(13)] public int OutputActionCount { get; set; }

       public int CalculateTotalWeights();
       public void InitializeRandomWeights(Random rng);
       public NetworkGenome Clone();
   }
   ```

5. Create `GenomeSerializer`:
   ```csharp
   public static class GenomeSerializer
   {
       public static byte[] Serialize(NetworkGenome genome);
       public static NetworkGenome Deserialize(byte[] data);
       public static async Task SaveAsync(NetworkGenome genome, string path);
       public static async Task<NetworkGenome> LoadAsync(string path);
   }
   ```

6. Create factory for default genome:
   ```csharp
   public static class GenomeFactory
   {
       public static NetworkGenome CreateDefault(int inputWidth, int inputHeight);
       public static NetworkGenome CreateRandom(Random rng, int inputWidth, int inputHeight);
   }
   ```

7. Create tests:
   - Test_Genome_Serialization_RoundTrip
   - Test_WeightCount_MatchesArchitecture
   - Test_Clone_CreatesDeepCopy
   - Test_RandomInitialization_HasVariance
   - Test_InvalidConfig_ThrowsException

## Outputs
- `src/TzarBot.NeuralNetwork/TzarBot.NeuralNetwork.csproj`
- `src/TzarBot.NeuralNetwork/Genome/NetworkGenome.cs`
- `src/TzarBot.NeuralNetwork/Genome/LayerConfig.cs`
- `src/TzarBot.NeuralNetwork/Genome/ActivationType.cs`
- `src/TzarBot.NeuralNetwork/Genome/GenomeSerializer.cs`
- `tests/TzarBot.Tests/Phase2/GenomeTests.cs`

## Test Command
```bash
dotnet test tests/TzarBot.Tests --filter "FullyQualifiedName~Phase2.Genome"
```

## Validation Steps
1. Check all files created
2. Run dotnet build
3. Run tests
4. Verify serialized file size is reasonable

## On Failure
If serialization fails:
1. Check MessagePack attributes are correct
2. Verify all types are supported by MessagePack
3. Check for circular references
4. Use MessagePack.Resolvers.StandardResolver
