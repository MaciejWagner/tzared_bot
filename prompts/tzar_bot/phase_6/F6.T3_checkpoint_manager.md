# F6.T3: Checkpoint Manager

## Agent: QA_INTEGRATION

## Task Overview
Implement checkpoint saving and loading for training recovery and state persistence.

## Context
Project: `src/TzarBot.Training/`. Enable recovery from failures.

## Requirements

1. Create `Checkpoint` (MessagePack serializable):
   ```csharp
   [MessagePackObject]
   public class Checkpoint
   {
       [Key(0)] public int Generation { get; set; }
       [Key(1)] public string StageName { get; set; }
       [Key(2)] public int StageNumber { get; set; }
       [Key(3)] public List<byte[]> PopulationData { get; set; }
       [Key(4)] public byte[] BestGenomeData { get; set; }
       [Key(5)] public List<GenerationStats> History { get; set; }
       [Key(6)] public DateTime CreatedAt { get; set; }
       [Key(7)] public DateTime TrainingStartedAt { get; set; }
       [Key(8)] public string Version { get; set; }
       [Key(9)] public Dictionary<string, object> Metadata { get; set; }
   }
   ```

2. Create interface:
   ```csharp
   public interface ICheckpointManager
   {
       Task<bool> HasCheckpointAsync();
       Task<TrainingState?> LoadLatestAsync();
       Task<TrainingState?> LoadAsync(string path);
       Task SaveAsync(TrainingState state);
       Task<IEnumerable<CheckpointInfo>> ListCheckpointsAsync();
       Task CleanupOldCheckpointsAsync(int keepCount);
   }
   ```

3. Implement `CheckpointManager`:
   - Save population and best genome
   - Filename with generation and timestamp
   - Cleanup old checkpoints
   - Always save best_genome.bin separately

4. Create `AutoCheckpointer`:
   - Timer-based auto-save
   - Configurable interval

5. Create tests:
   - Test_Save_CreatesFile
   - Test_Load_RestoresState
   - Test_RoundTrip_PreservesData
   - Test_Cleanup_KeepsOnlyRecent
   - Test_BestGenome_AlwaysSaved

## Outputs
- `src/TzarBot.Training/Checkpoint/ICheckpointManager.cs`
- `src/TzarBot.Training/Checkpoint/CheckpointManager.cs`
- `src/TzarBot.Training/Checkpoint/Checkpoint.cs`
- `tests/TzarBot.Tests/Phase6/CheckpointTests.cs`

## Test Command
```bash
dotnet test tests/TzarBot.Tests --filter "FullyQualifiedName~Phase6.Checkpoint"
```
