# F6.T1: Training Loop Core

## Agent: AI_SENIOR

## Task Overview
Implement the main training loop that coordinates evolution, evaluation, and progression.

## Context
Create new project `src/TzarBot.Training/`. This is the top-level orchestration.

## Requirements

1. Create configuration:
   ```csharp
   public class TrainingConfig
   {
       public int PopulationSize { get; set; } = 100;
       public int InitialGeneration { get; set; } = 0;
       public int GamesPerGenome { get; set; } = 3;
       public TimeSpan GameTimeout { get; set; } = TimeSpan.FromMinutes(30);
       public int MaxParallelVMs { get; set; } = 8;
       public bool AutoStartVMs { get; set; } = true;
       public int CheckpointInterval { get; set; } = 10;
       public string CheckpointPath { get; set; } = "./checkpoints";
       public int? MaxGenerations { get; set; } = null;
       public float? TargetFitness { get; set; } = null;
       public float? TargetWinRate { get; set; } = 0.9f;
   }
   ```

2. Create `TrainingState`:
   ```csharp
   public class TrainingState
   {
       public int CurrentGeneration { get; set; }
       public string CurrentStage { get; set; }
       public Population Population { get; set; }
       public NetworkGenome BestGenome { get; set; }
       public List<GenerationStats> History { get; set; }
       public DateTime StartedAt { get; set; }
       public DateTime? LastCheckpoint { get; set; }
       public TrainingStatus Status { get; set; }
   }
   ```

3. Create interface:
   ```csharp
   public interface ITrainingPipeline
   {
       TrainingState State { get; }
       TrainingConfig Config { get; }

       Task InitializeAsync(CancellationToken ct);
       Task RunAsync(CancellationToken ct);
       Task PauseAsync();
       Task ResumeAsync();
       Task<bool> SaveCheckpointAsync();
       Task<bool> LoadCheckpointAsync(string path);

       event Action<GenerationStats>? OnGenerationComplete;
       event Action<string>? OnStageAdvanced;
       event Action<NetworkGenome>? OnNewBestGenome;
       event Action<string>? OnError;
   }
   ```

4. Implement `TrainingPipeline`:
   - Load from checkpoint if available
   - Initialize orchestrator
   - Run generation loop
   - Calculate and assign fitness
   - Track statistics
   - Check curriculum advancement
   - Evolve to next generation

5. Create tests:
   - Test_Initialize_CreatesPopulation
   - Test_RunGeneration_AdvancesGeneration
   - Test_FitnessAssignment_Works
   - Test_BestGenome_IsTracked
   - Test_GracefulShutdown_SavesState

## Outputs
- `src/TzarBot.Training/TzarBot.Training.csproj`
- `src/TzarBot.Training/Core/ITrainingPipeline.cs`
- `src/TzarBot.Training/Core/TrainingPipeline.cs`
- `src/TzarBot.Training/Core/TrainingConfig.cs`
- `src/TzarBot.Training/Core/TrainingState.cs`
- `tests/TzarBot.Tests/Phase6/TrainingPipelineTests.cs`

## Test Command
```bash
dotnet test tests/TzarBot.Tests --filter "FullyQualifiedName~Phase6.TrainingPipeline"
```
