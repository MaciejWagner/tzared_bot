# F2.T5: Phase 2 Integration Tests

## Agent: QA_INTEGRATION

## Task Overview
Create integration tests that verify the full neural network pipeline from raw frame to action output.

## Context
All Phase 2 components are implemented. Verify end-to-end functionality.

## Requirements

1. Create demo console app `src/TzarBot.NeuralNetwork.Demo/`:
   - Create random genome
   - Build ONNX model
   - Create inference engine
   - Capture screen (or use test image)
   - Preprocess frame
   - Run inference
   - Print action output
   - Measure and report timing

2. Create integration tests:
   ```csharp
   public class NeuralNetworkIntegrationTests
   {
       [Fact]
       public void FullPipeline_Frame_To_Action()
       {
           var frame = CreateTestFrame(1920, 1080);
           var genome = GenomeFactory.CreateRandom(new Random(42), 240, 135);
           var builder = new OnnxNetworkBuilder();
           var modelData = builder.BuildModel(genome);
           var preprocessor = new ImagePreprocessor();
           var engine = new OnnxInferenceEngine(modelData);
           var buffer = new FrameBuffer(4);

           for (int i = 0; i < 4; i++)
           {
               buffer.AddFrame(preprocessor.ProcessFrame(frame));
           }

           var action = engine.Infer(buffer.GetStackedFrames());

           Assert.NotNull(action);
           Assert.InRange(action.MouseDeltaX, -100, 100);
       }

       [Fact]
       public void Genome_Serialization_PreservesBehavior()
       {
           // Verify serialized genome produces same outputs
       }

       [Fact]
       public void Performance_EndToEnd_Under100ms()
       {
           // Benchmark full pipeline
       }
   }
   ```

3. Add performance benchmarks to demo:
   - Preprocessing time
   - Inference time
   - Total pipeline time
   - Memory usage

## Outputs
- `tests/TzarBot.Tests/Phase2/IntegrationTests.cs`
- `src/TzarBot.NeuralNetwork.Demo/Program.cs`
- `src/TzarBot.NeuralNetwork.Demo/TzarBot.NeuralNetwork.Demo.csproj`

## Test Commands
```bash
dotnet test tests/TzarBot.Tests --filter "FullyQualifiedName~Phase2.Integration"
dotnet run --project src/TzarBot.NeuralNetwork.Demo
```

## Validation Steps
1. All integration tests pass
2. Demo runs successfully
3. Performance is acceptable
4. Memory usage is stable

## On Failure
If integration fails:
1. Test individual components
2. Check tensor shapes match
3. Verify weight initialization
4. Add logging for debugging
