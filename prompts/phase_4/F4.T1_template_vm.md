# F4.T1: Template VM Creation

## Agent: DEVOPS_SENIOR

## Task Overview
Create and configure the template VM that will be cloned for worker VMs.

## Type: MANUAL TASK

## Prerequisites
- F0.T1-T4 completed (Host setup, Dev VM, Game installed)
- Windows ISO available
- Hyper-V enabled

## Steps

### 1. Create Template VM
```powershell
New-VM -Name "TzarBot-Template" `
       -Generation 2 `
       -MemoryStartupBytes 4GB `
       -NewVHDPath "C:\VMs\TzarBot-Template.vhdx" `
       -NewVHDSizeBytes 50GB `
       -SwitchName "TzarBotSwitch"

Set-VM -Name "TzarBot-Template" `
       -ProcessorCount 2 `
       -DynamicMemory `
       -MemoryMinimumBytes 2GB `
       -MemoryMaximumBytes 4GB `
       -CheckpointType Production

Add-VMDvdDrive -VMName "TzarBot-Template" -Path "C:\ISOs\Windows.iso"
```

### 2. Install Windows
- Start VM and install Windows 10/11
- Create local account "TzarBot" with password
- Disable Windows Update (for stability)
- Disable Screen Saver and Sleep

### 3. Install Game
- Copy game installer from host
- Install Tzar game
- Configure windowed mode
- Test game runs correctly

### 4. Install Bot Agent
- Install .NET 8 Runtime
- Create C:\TzarBot\ directory
- Configure auto-start

### 5. Configure Networking
```powershell
# In VM - set static IP template
New-NetIPAddress -InterfaceAlias "Ethernet" -IPAddress 192.168.100.100 -PrefixLength 24 -DefaultGateway 192.168.100.1
Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses 8.8.8.8,8.8.4.4
```

### 6. Enable Remote Management
```powershell
Enable-PSRemoting -Force
Set-Item WSMan:\localhost\Client\TrustedHosts -Value "*" -Force
```

### 7. Generalize and Create Checkpoint
```powershell
# On host
Stop-VM -Name "TzarBot-Template"
Checkpoint-VM -Name "TzarBot-Template" -SnapshotName "Ready-For-Clone"
```

## Outputs
- `C:\VMs\TzarBot-Template.vhdx` - Template VHD
- Template checkpoint ready for cloning

## Validation
- [ ] Template VM boots
- [ ] Game runs in template
- [ ] Network configured
- [ ] Remote management works
- [ ] Checkpoint created
